export default async function handler(req, res) { if (req.method !== 'POST') { return res.status(405).json({ error: 'Method not allowed' }); } const telegramUrl = `https://api.telegram.org/bot${process.env.BOT_TOKEN}/sendMessage`; const channelId = process.env.CHANNEL_ID; try { const telemetryData = req.body; const message = formatTelemetryMessage(telemetryData); const response = await fetch(telegramUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ chat_id: channelId, text: message, parse_mode: 'HTML' }) }); if (!response.ok) { throw new Error('Telegram API error'); } return res.status(200).json({ status: 'ok' }); } catch (error) { console.error('Error:', error); return res.status(500).json({ error: 'Failed to send telemetry' }); } } function formatTelemetryMessage(data) { const timestamp = new Date().toISOString(); const entries = Object.entries(data) .map(([key, value]) => `<b>${key}</b>: ${value}`) .join('\n'); return `ğŸ“Š Telemetry Report\nâ° ${timestamp}\n\n${entries}`; }
